<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>Clappr Player + Playlist + Remote Control + ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á  + ‡∏Å‡∏î1‡πÄ‡∏ï‡πá‡∏°‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠</title>
  <script src="https://cdn.jsdelivr.net/npm/clappr@latest/dist/clappr.min.js"></script>
  <style>
    body { margin: 0; font-family: sans-serif; background: #000; color: #fff; display: flex; height: 100vh; }
    #menu { width: 300px; background: #6a1b9a; overflow-y: auto; padding: 10px; }
    .group h3 { margin: 0; padding: 8px; background: #7e57c2; border-radius: 4px; cursor: pointer; }
    .item-list { display: none; padding-left: 10px; }
    .item { display: flex; align-items: center; margin: 4px 0; padding: 6px; background: #9575cd; border-radius: 4px; cursor: pointer; transition: background 0.3s; }
    .item img { width: 60px; height: 35px; object-fit: cover; margin-right: 8px; }
    .item.active { background: #f06292; }
    .item:hover, .item:focus { background: yellow; color: black; outline: none; }
    .focus-player { outline: 3px solid yellow; }
    #player { flex: 1; position: relative; }
  </style>
</head>
<body>
  <div id="menu"><h2>üì∫ Playlist</h2><div id="playlist"></div></div>
  <div id="player"></div>

  <script>
    const playlistURLs = ["https://dl.dropbox.com/scl/fi/crrobvdwowocm61wxkr35/series-indy-1.m3u?rlkey=6vcsjrmshl8lj54shy2ftn8d7&dl=1"];
    let clapprPlayer;
    let focusIndex = 0; // index ‡∏Ç‡∏≠‡∏á‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÇ‡∏ü‡∏Å‡∏±‡∏™‡πÉ‡∏ô‡πÄ‡∏°‡∏ô‡∏π
    let mode = "menu"; // menu ‡∏´‡∏£‡∏∑‡∏≠ player

    async function loadPlaylist() {
      for (let url of playlistURLs) {
        try {
          const res = await fetch(url);
          const text = await res.text();
          if (url.endsWith(".json")) return JSON.parse(text);
          const lines = text.split("\n");
          let list = [], cur = {};
          for (let line of lines) {
            line = line.trim();
            if (line.startsWith("#EXTINF")) {
              cur = {
                title: line.split(",").pop().trim(),
                group: (line.match(/group-title="(.*?)"/) || ["",""])[1] || "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà",
                image: (line.match(/tvg-logo="(.*?)"/) || ["",""])[1] || ""
              };
            } else if (line && !line.startsWith("#")) {
              cur.file = line;
              list.push({ ...cur });
            }
          }
          return list;
        } catch {}
      }
      return [];
    }

    function renderMenu(list) {
      const menu = document.getElementById("playlist");
      menu.innerHTML = "";
      const groups = [...new Set(list.map(x => x.group))];
      groups.forEach(group => {
        const gd = document.createElement("div"), hd = document.createElement("h3"), il = document.createElement("div");
        gd.className = "group";
        hd.textContent = group;
        il.className = "item-list";
        hd.onclick = () => il.style.display = il.style.display === "block" ? "none" : "block";
        list.filter(x => x.group === group).forEach(item => {
          const it = document.createElement("div");
          it.className = "item";
          it.tabIndex = 0;
          it.innerHTML = item.image ? `<img src="${item.image}"><span>${item.title}</span>` : item.title;
          it.onclick = () => {
            document.querySelectorAll(".item").forEach(e => e.classList.remove("active"));
            it.classList.add("active");
            loadClapprPlayer(item);
          };
          il.appendChild(it);
        });
        gd.append(hd, il); menu.appendChild(gd);
      });
      const firstList = document.querySelector(".item-list");
      if (firstList) firstList.style.display = "block";
    }

    function loadClapprPlayer(item) {
      if (clapprPlayer) {
        clapprPlayer.destroy();
        document.getElementById("player").innerHTML = "";
      }
      clapprPlayer = new Clappr.Player({
        source: item.file,
        poster: item.image || "",
        parentId: "#player",
        width: "100%",
        height: "100%",
        autoPlay: true,
        playback: { playInline: true },
        mute: false
      });
    }

    function setFocus(index) {
      const items = document.querySelectorAll(".item");
      if (items.length === 0) return;
      if (index < 0) index = items.length - 1;
      if (index >= items.length) index = 0;
      focusIndex = index;
      items.forEach(e => e.classList.remove("focus"));
      items[focusIndex].focus();
    }

    function handleRemoteControl(e) {
      const items = document.querySelectorAll(".item");
      if (items.length === 0) return;

      if (mode === "menu") {
        switch (e.key) {
          case "ArrowDown":
            setFocus(focusIndex + 1);
            break;
          case "ArrowUp":
            setFocus(focusIndex - 1);
            break;
          case "Enter":
          case " ":
            items[focusIndex].click();
            break;
          case "ArrowRight":
          case "Tab":
            mode = "player";
            document.getElementById("player").classList.add("focus-player");
            break;
        }
      } else if (mode === "player") {
        switch (e.key) {
          case "ArrowLeft":
            mode = "menu";
            document.getElementById("player").classList.remove("focus-player");
            break;
          case "Enter":
          case " ":
            if (clapprPlayer) {
              if (clapprPlayer.isPlaying()) clapprPlayer.pause();
              else clapprPlayer.play();
            }
            break;
          case "1": // ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏•‡∏Ç 1 ‡∏™‡∏•‡∏±‡∏ö fullscreen
            toggleFullscreen();
            break;
        }
      }
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏•‡∏±‡∏ö fullscreen
    function toggleFullscreen() {
      const playerElement = document.getElementById("player");
      if (!document.fullscreenElement) {
        if (playerElement.requestFullscreen) {
          playerElement.requestFullscreen();
        } else if (playerElement.webkitRequestFullscreen) { // Safari
          playerElement.webkitRequestFullscreen();
        } else if (playerElement.msRequestFullscreen) { // IE11
          playerElement.msRequestFullscreen();
        }
      } else {
        if (document.exitFullscreen) {
          document.exitFullscreen();
        } else if (document.webkitExitFullscreen) { // Safari
          document.webkitExitFullscreen();
        } else if (document.msExitFullscreen) { // IE11
          document.msExitFullscreen();
        }
      }
    }

    async function init() {
      const list = await loadPlaylist();
      if (list.length === 0) return;
      renderMenu(list);
      const first = document.querySelector(".item");
      if (first) {
        setFocus(0);
        first.click();
      }
      document.addEventListener("keydown", handleRemoteControl);
    }

    document.addEventListener("DOMContentLoaded", init);
  </script>
</body>
</html>
